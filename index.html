<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accesso Polizia</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #0c0c0c;
            color: #f0f0f0;
            line-height: 1.6;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%230c0c0c"/><path d="M0 0L100 100" stroke="%23222" stroke-width="1"/><path d="M100 0L0 100" stroke="%23222" stroke-width="1"/></svg>');
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 1px solid #333;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2.5rem;
            color: #d32f2f;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            margin-bottom: 10px;
        }
        
        h2 {
            color: #e0e0e0;
            margin-bottom: 20px;
        }
        
        h3 {
            color: #d32f2f;
            margin: 20px 0 10px;
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
        }
        
        .login-container {
            background-color: #1a1a1a;
            border-radius: 8px;
            padding: 30px;
            max-width: 500px;
            margin: 50px auto;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            border: 1px solid #333;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #e0e0e0;
        }
        
        input[type="text"],
        input[type="password"] {
            width: 100%;
            padding: 12px;
            background-color: #2c2c2c;
            border: 1px solid #444;
            border-radius: 4px;
            color: #f0f0f0;
            font-size: 16px;
        }
        
        input[type="text"]:focus,
        input[type="password"]:focus {
            outline: none;
            border-color: #d32f2f;
        }
        
        button {
            background-color: #d32f2f;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            width: 100%;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #b71c1c;
        }
        
        .error-message {
            color: #f44336;
            margin-top: 10px;
            text-align: center;
            display: none;
        }
        
        .main-content {
            display: none;
        }
        
        .search-system {
            background-color: #1a1a1a;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }
        
        .search-box {
            display: flex;
            margin-bottom: 20px;
        }
        
        .search-box input {
            flex-grow: 1;
            padding: 10px;
            background-color: #2c2c2c;
            border: 1px solid #444;
            border-radius: 4px 0 0 4px;
            color: #f0f0f0;
        }
        
        .search-box button {
            width: auto;
            border-radius: 0 4px 4px 0;
        }
        
        .search-results {
            background-color: #2c2c2c;
            border-radius: 4px;
            padding: 20px;
            min-height: 200px;
        }
        
        .report-section {
            background-color: #1a1a1a;
            border-left: 4px solid #d32f2f;
            padding: 15px;
            margin: 15px 0;
        }
        
        .evidence-list {
            list-style-type: none;
            margin: 10px 0;
        }
        
        .evidence-list li {
            padding: 5px 0;
            border-bottom: 1px dashed #444;
        }
        
        .highlight {
            color: #d32f2f;
            font-weight: bold;
        }
        
        footer {
            text-align: center;
            padding: 20px 0;
            border-top: 1px solid #333;
            margin-top: 30px;
            color: #888;
        }
        
        .police-badge {
            display: inline-block;
            background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
            border: 2px solid #d32f2f;
            border-radius: 50%;
            width: 80px;
            height: 80px;
            line-height: 80px;
            text-align: center;
            margin-bottom: 20px;
            font-size: 12px;
            color: #d32f2f;
            font-weight: bold;
        }
        
        .timestamp {
            color: #888;
            font-style: italic;
            font-size: 0.9em;
            text-align: right;
            display: block;
            margin-top: 10px;
        }

        /* Telecamere */
        .cameras-section {
            background-color: #1a1a1a;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }
        
        .year-folders {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .year-folder {
            background-color: #2c2c2c;
            border: 1px solid #444;
            border-radius: 4px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .year-folder:hover {
            background-color: #3a3a3a;
            border-color: #d32f2f;
            transform: translateY(-3px);
        }
        
        .year-folder h4 {
            color: #d32f2f;
            margin-bottom: 5px;
        }
        
        .year-folder p {
            color: #aaa;
            font-size: 0.9em;
        }
        
        .month-folders {
            display: none;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        
        .month-folder {
            background-color: #2c2c2c;
            border: 1px solid #444;
            border-radius: 4px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .month-folder:hover {
            background-color: #3a3a3a;
            border-color: #d32f2f;
        }
        
        .month-folder h5 {
            color: #e0e0e0;
            margin-bottom: 5px;
        }
        
        .month-folder p {
            color: #aaa;
            font-size: 0.8em;
        }
        
        .camera-images {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background-color: #2c2c2c;
            border-radius: 4px;
        }
        
        .camera-images h3 {
            color: #e0e0e0;
            margin-bottom: 15px;
        }
        
        .images-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .camera-image {
            background-color: #1a1a1a;
            border-radius: 4px;
            padding: 10px;
            text-align: center;
        }
        
        .camera-image img {
            max-width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        
        .camera-image p {
            color: #aaa;
            font-size: 0.9em;
        }
        
        .placeholder-image {
            width: 100%;
            height: 150px;
            background-color: #333;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
            color: #888;
        }
        
        .back-button {
            background-color: #444;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        .back-button:hover {
            background-color: #555;
        }

        .media-section {
            margin-top: 25px;
            background-color: #1a1a1a;
            border-left: 4px solid #d32f2f;
            padding: 15px;
            border-radius: 4px;
        }

        .media-content {
            margin-top: 10px;
        }

        .media-content img, 
        .media-content video {
            display: block;
            margin: 10px auto;
            box-shadow: 0 0 10px rgba(0,0,0,0.4);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.9);
            text-align: center;
        }

        .modal-content {
            margin: 2% auto; /* Ridotto il margine superiore per dare più spazio */
            display: block;
            width: auto;
            max-width: 95%; /* Usa quasi tutto lo schermo */
            max-height: 90vh; /* Altezza massima al 90% della visuale verticale */
            border-radius: 4px;
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
            object-fit: contain; /* Mantiene le proporzioni senza tagliare */
        }

        .close {
            position: absolute;
            top: 15px;
            right: 30px;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
        }

        #caption {
            color: #ccc;
            margin-top: 10px;
            font-size: 16px;
        }

        .interrogation-folders {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .interrogation-folder {
            background-color: #2c2c2c;
            border: 1px solid #444;
            border-radius: 4px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .interrogation-folder:hover {
            background-color: #3a3a3a;
            border-color: #d32f2f;
            transform: translateY(-2px);
        }

        .interrogation-content {
            background-color: #1a1a1a;
            border-left: 4px solid #d32f2f;
            border-radius: 4px;
            padding: 20px;
            color: #ddd;
        }

        .countdown {
            text-align: center;
            margin: 20px 0;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
        }

        #countdownTimer {
            font-size: 2rem;
            font-weight: bold;
            margin-top: 10px;
            color: #ffcc00;
            letter-spacing: 2px;
        }

        #modalImg:hover {
            cursor: zoom-out;
            transform: scale(1.20); /* Ingrandisce del 5% al passaggio del mouse */
            transition: transform 0.3s ease;
        }
        
        .unlock-notification {
            background: rgba(255, 204, 0, 0.2);
            border: 1px solid #ffcc00;
            padding: 10px 15px;
            margin: 15px 0;
            border-radius: 6px;
            color: #ffcc00;
            font-weight: bold;
            text-align: center;
            animation: pulse 1s infinite;
            cursor: pointer;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 5px #ffcc00; }
            50% { box-shadow: 0 0 15px #ffcc00; }
            100% { box-shadow: 0 0 5px #ffcc00; }
        }

    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="police-badge">POLIZIA</div>
            <h1>INVESTIGAZIONE CRIMINE</h1>
            <h2>Accesso Riservato</h2>
        </header>

        <div id="loginPage">
            <div class="login-container">
                <h2>Accesso Agenti</h2>
                <div class="form-group">
                    <label for="username">Nome Utente</label>
                    <input type="text" id="username" placeholder="Inserisci il nome utente">
                </div>
                <div class="form-group">
                    <label for="password">Password (lettere minuscole+numeri)</label>
                    <input type="password" id="password" placeholder="Inserisci la password">
                </div>
                <button id="loginBtn">ACCEDI AL SISTEMA</button>
                <div id="errorMsg" class="error-message">Credenziali non valide. Riprovare.</div>
            </div>
        </div>

        <div id="mainPage" class="main-content">
            <div class="search-system">
                <h2>Sistema di Ricerca Dati</h2>

                <div id="countdownBox" class="countdown">
                    <h3>La polizia sta indagando. Sblocco nuovi dati in:</h3>
                    <div id="countdownTimer">--:--</div>
                </div>

                <div id="unlockNotification" class="unlock-notification" style="display:none;">
                    Nuovi dati disponibili sulla morte di Ettore nel suo fascicolo, inoltre potete aprire la terza e ultima busta.
                </div>

                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="Inserisci termine di ricerca...">
                    <button id="searchBtn">CERCA</button>
                </div>
                <div class="search-results">
                    <p>Inserire un termine di ricerca (in minuscolo) per cercare informazioni sul database.</p>
                </div>
            </div>

            <!-- Archivio telecamere in basso -->
            <div class="cameras-section">
                <h2>Archivio Telecamere</h2>
                <p>Seleziona un anno per visualizzare i mesi disponibili. Il formato di visualizzazione è luogo - giorno - ora.</p>
                
                <div class="year-folders">
                    <!-- Le cartelle degli anni verranno generate dinamicamente con JavaScript -->
                </div>
                
                <div class="month-folders">
                    <!-- Le cartelle dei mesi verranno caricate qui dinamicamente -->
                </div>
                
                <div id="cameraImages" class="camera-images">
                    <!-- Le immagini delle telecamere verranno caricate qui dinamicamente -->
                </div>
            </div>
        </div>

        <footer>
            <p>Sistema riservato di investigazione - Divulgazione vietata</p>
            <p>© 2025 Polizia Scientifica</p>
        </footer>
    </div>

    <div id="imageModal" class="modal" style="display:none;">
        <span class="close" id="closeModal">&times;</span>
        <img id="modalImg" class="modal-content">
        <div id="caption"></div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {

            /* =========================================
               CONFIG TIMER & UTIL
            ========================================== */
            const STEP2_DELAY_MINUTES = 45;
            const STEP2_DELAY_MS = STEP2_DELAY_MINUTES * 60 * 1000;

            function getGameStartTime() {
                let t = localStorage.getItem('police_game_start');
                return t ? parseInt(t) : null; // Ritorna null se il gioco non è ancora iniziato
            }

            function isStep2Unlocked() {
                const start = getGameStartTime();
                if (!start) return false;
                return (Date.now() - start) >= STEP2_DELAY_MS;
            }

            const RESET_AFTER_HOURS = 24;
            const RESET_AFTER_MS = RESET_AFTER_HOURS * 60 * 60 * 1000;

            function autoResetAfter24h() {
                const start = localStorage.getItem('police_game_start');
                if (!start) return;

                const elapsed = Date.now() - start;
                if (elapsed >= RESET_AFTER_MS) {
                    localStorage.removeItem('police_game_start');
                    location.reload(); 
                }
            }

            let unlockedTriggered = false;

            function refreshPageAfterUnlock() {
                if (unlockedTriggered) return;
                unlockedTriggered = true;

                const box = document.getElementById("unlockNotification");
                if (box) {
                    box.style.display = "block";
                    box.addEventListener("click", () => box.style.display = "none");
                }

                const timerBox = document.getElementById("countdownBox");
                if (timerBox) {
                    timerBox.style.opacity = "0.5";
                }
            }

            function updateCountdown() {
                const start = getGameStartTime();
                const timerBox = document.getElementById("countdownTimer");
                if (!timerBox) return;

                // Se il timer non è ancora partito (nessun login effettuato)
                if (!start) {
                    timerBox.textContent = "--:--";
                    return;
                }

                const now = Date.now();
                const remaining = STEP2_DELAY_MS - (now - start);

                if (remaining <= 0) {
                    timerBox.textContent = "00:00";
                    refreshPageAfterUnlock();
                    return;
                }

                const minutes = Math.floor(remaining / 60000);
                const seconds = Math.floor((remaining % 60000) / 1000);

                timerBox.textContent =
                    minutes.toString().padStart(2, "0") + ":" +
                    seconds.toString().padStart(2, "0");
            }

            /* =========================================
               RIFERIMENTI DOM
            ========================================== */
            const loginBtn = document.getElementById('loginBtn');
            const errorMsg = document.getElementById('errorMsg');
            const loginPage = document.getElementById('loginPage');
            const mainPage = document.getElementById('mainPage');
            const searchBtn = document.getElementById('searchBtn');
            const searchInput = document.getElementById('searchInput');
            const searchResults = document.querySelector('.search-results');
            const yearFolders = document.querySelector('.year-folders');
            const monthFolders = document.querySelector('.month-folders');
            const cameraImages = document.getElementById('cameraImages');

            /* =========================================
               DATI TELECAMERE
            ========================================== */
            const cameraDescriptions = {
                2009: {
                    "Febbraio": [
                        { image: "CCTV/CCTV1.jpeg",  text: "Parcheggio Mc Donald's Nord - 23 - 17:32" },
                        { image: "CCTV/CCTV43.jpeg", text: "Settore Ovest Stadio Abanca-Riazor - 28 - 12:24" },
                    ],
                    "Marzo": [
                        { image: "CCTV/CCTV15.jpeg", text: "Attracco visite turistiche - 03 - 10:46" },
                        { image: "CCTV/CCTV44.jpeg", text: "Controllo tetto stazione polizia - 12 - 14:01" },
                    ],
                    "Maggio": [
                        { image: "CCTV/CCTV28.jpeg", text: "Entrata sud scavi Monticaño - 10 - 16:33" },
                        { image: "CCTV/CCTV19.jpeg", text: "Attracco nord-est porto - 21 - 13:12" },
                    ],
                    "Luglio": [
                        { image: "CCTV/CCTV7.jpeg", text: "Via Albierto 2 - 15 - 17:56" },
                        { image: "CCTV/CCTV5.jpeg", text: "Superstrada raccordo sud - 17 - 16:43" },
                    ],
                    "Agosto": [
                        { image: "CCTV/CCTV35.jpeg", text: "Impianto sportivo Ruiz - 09 - 00:45" },
                        { image: "CCTV/CCTV10.jpeg", text: "Plaza Mipita - 23 - 15:06" },
                    ],
                    "Ottobre": [
                        { image: "CCTV/CCTV41.jpeg", text: "Ingresso est Chiesa Parua - 11 - 22:59" },
                        { image: "CCTV/CCTV25.jpeg", text: "Gate 23 Aeroporto - 14 - 14:16" },
                    ],
                    "Novembre": [
                        { image: "CCTV/CCTV17.jpeg", text: "Molo 3 - 04 - 10:34" },
                        { image: "CCTV/CCTV45.jpeg", text: "Cortile interno università - 12 - 07:16" },
                    ]
                },
                2012: {
                    "Febbraio": [
                        { image: "CCTV/CCTV2.jpeg", text: "Parcheggio Corte Ingles - 09 - 16:32" },
                    ],
                    "Marzo": [
                        { image: "CCTV/CCTV39.jpeg", text: "Molo 2 porto commerciale - 15 - 05:48" },
                    ],
                    "Maggio": [
                        { image: "CCTV/CCTVimportanteveramente.png", text: "Monastero di San Andro - 24 - 00:35" },
                    ],
                    "Luglio": [
                        { image: "CCTV/CCTV13.jpeg", text: "Parcheggio porto - 10 - 22:46" },
                    ],
                    "Agosto": [
                        { image: "CCTV/CCTV27.jpeg", text: "Rovine Monticaño - 24 - 14:56" },
                    ],
                    "Ottobre": [
                        { image: "CCTV/CCTV18.jpeg", text: "Molo privato 3 - 15 - 13:27" },
                    ],
                    "Novembre": [
                        { image: "CCTV/CCTV14.jpeg", text: "Porto commerciale zona carico - 30 - 16:11" },
                    ]
                },
                2015: {
                    "Febbraio": [
                        { image: "CCTV/CCTV29.jpeg", text: "Rovine romane Monticaño - 07 - 12:06" },
                    ],
                    "Marzo": [
                        { image: "CCTV/CCTV37.jpeg", text: "Molo 6 - 18 - 02:19" },
                    ],
                    "Maggio": [
                        { image: "CCTV/CCTV12.jpeg", text: "Parco Tariquo - 25 - 00:24" },
                    ],
                    "Luglio": [
                        { image: "CCTV/CCTV34.jpeg", text: "Scavi Nord-Est - 29 - 03:45" },
                    ],
                    "Agosto": [
                        { image: "CCTV/CCTV21.jpeg", text: "Lungomare Lucio - 16 - 15:07" },
                    ],
                    "Ottobre": [
                        { image: "CCTV/CCTV40.jpeg", text: "Piazza Ruveira - 05 - 01:13" },
                    ],
                    "Novembre": [
                        { image: "CCTV/CCTV31.jpeg", text: "Rovine romane Monticaño - 19 - 16:54" },
                    ]
                },
                2018: {
                    "Febbraio": [
                        { image: "CCTV/CCTV3.jpeg", text: "Via Central - 02 - 13:42" },
                    ],
                    "Marzo": [
                        { image: "CCTV/CCTV32.jpeg", text: "Settore sud scavi - 14 - 00:54" },
                    ],
                    "Maggio": [
                        { image: "CCTV/CCTV26.jpeg", text: "Zona Imbarco 4 - 06 - 15:21" },
                    ],
                    "Luglio": [
                        { image: "CCTV/CCTV9.jpeg", text: "Via Callata - 28 - 17:01" },
                    ],
                    "Agosto": [
                        { image: "CCTV/CCTV46.jpeg", text: "Zona universitaria - 29 - 11:43" },
                    ],
                    "Ottobre": [
                        { image: "CCTV/CCTV33.jpeg", text: "Rovine romane Monticaño - 21 - 04:14" },
                    ],
                    "Novembre": [
                        { image: "CCTV/CCTV6.jpeg", text: "Superstrada Rite - 16:57" },
                    ]
                },
                2021: {
                    "Febbraio": [
                        { image: "CCTV/CCTV24.jpeg", text: "Parcheggio Corte Ingles - 12:41" },
                    ],
                    "Marzo": [
                        { image: "CCTV/CCTV30.jpeg", text: "Scavi Est - 08 - 15:37" },
                    ],
                    "Maggio": [
                        { image: "CCTV/CCTV20.jpeg", text: "Magazzino 5 porto - 29 - 16:55" },
                    ],
                    "Luglio": [
                        { image: "CCTV/CCTV38.jpeg", text: "Porto commerciale - 21 - 03:21" },
                    ],
                    "Agosto": [
                        { image: "CCTV/CCTV16.jpeg", text: "Molo 4 - 30 - 18:00" },
                    ],
                    "Ottobre": [
                        { image: "CCTV/CCTV8.jpeg", text: "Via Francisco - 11 - 20:56" },
                    ],
                    "Novembre": [
                        { image: "CCTV/CCTV42.jpeg", text: "Plaza Ventura - 26 - 22:15" },
                    ]
                },
                2024: {
                    "Febbraio": [
                        { image: "CCTV/CCTV11.jpeg", text: "Centro storico - 27 - 23:18" },
                    ],
                    "Marzo": [
                        { image: "CCTV/CCTV22.jpeg", text: "Porto turistico - 04 - 12:10" },
                    ],
                    "Maggio": [
                        { image: "CCTV/CCTV48.jpeg", text: "Università retro - 25 - 17:43" },
                    ],
                    "Luglio": [
                        { image: "CCTV/CCTV36.jpeg", text: "Entrata merci 32 - 09 - 00:15" },
                    ],
                    "Agosto": [
                        { image: "CCTV/CCTV23.jpeg", text: "Gate 21 aeroporto - 28 - 17:04" },
                    ],
                    "Ottobre": [
                        { image: "CCTV/CCTV4.jpeg", text: "Via Gorda - 16 - 16:29" },
                    ],
                    "Novembre": [
                        { image: "CCTV/CCTV47.jpeg", text: "Centro sportivo Serces - 22 - 17:03" },
                    ]
                },
            };

            /* =========================================
                LOGICA DI AVVIO
            ========================================== */
    
            // Controlla se l'utente era già loggato precedentemente
            const existingStart = getGameStartTime();
            if (existingStart) {
                // Se c'è un tempo salvato, salta il login e avvia il countdown
                loginPage.style.display = 'none';
                mainPage.style.display = 'block';
                generateYearFolders();
                setInterval(updateCountdown, 1000);
            } else {
                // Altrimenti mostra il login
                loginPage.style.display = 'block';
                mainPage.style.display = 'none';
            }

            autoResetAfter24h();
            updateCountdown();

            /* =========================================
                LOGIN
            ========================================== */
            let attempts = 0;
            loginBtn.addEventListener('click', function() {
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;

                if (username === 'Ines Cabral' && password === 'santiago2021') {
                    // Fai partire il timer solo ORA
                    if (!localStorage.getItem('police_game_start')) {
                        localStorage.setItem('police_game_start', Date.now().toString());
                    }
    
                    loginPage.style.display = 'none';
                    mainPage.style.display = 'block';
                    generateYearFolders();
    
                    // Avvia il ciclo del countdown
                    updateCountdown(); 
                    setInterval(updateCountdown, 1000);
                } else {
                    attempts++;
                    errorMsg.style.display = 'block';
                    document.getElementById('password').value = '';

                    if (attempts === 3) {
                        const hint = document.createElement('p');
                        hint.style.color = '#aaa';
                        hint.style.textAlign = 'center';
                        hint.style.marginTop = '10px';
                        hint.textContent = 'Consiglio di sistema: a volte la chiave è nel cammino.';
                        loginPage.querySelector('.login-container').appendChild(hint);
                    } else if (attempts === 6) {
                        const hint = document.createElement('p');
                        hint.style.color = '#aaa';
                        hint.style.textAlign = 'center';
                        hint.style.marginTop = '10px';
                        hint.textContent = 'Consiglio di sistema: formato nome+anno.';
                        loginPage.querySelector('.login-container').appendChild(hint);
                    }
                    
                    loginPage.style.animation = 'shake 0.5s';
                    setTimeout(() => {
                        loginPage.style.animation = '';
                    }, 500);
                }
            });

            // Invio = login (se login visibile) o cerca (se main attivo)
            document.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    if (loginPage.style.display !== 'none') {
                        loginBtn.click();
                    } else {
                        searchBtn.click();
                    }
                }
            });

            /* =========================================
               SISTEMA DI RICERCA
            ========================================== */
            searchBtn.addEventListener('click', function() {
                const searchTerm = searchInput.value.trim().toLowerCase();

                // Comandi speciali per te (host)
                if (searchTerm === "resetpolice") {
                    localStorage.removeItem("police_game_start");
                    alert("Timer resettato! La pagina verrà ricaricata.");
                    location.reload();
                    return;
                } else if (searchTerm === "unlockettore") {
                    localStorage.setItem("police_game_start", (Date.now() - STEP2_DELAY_MS).toString());
                    alert("Dati su Ettore sbloccati immediatamente!");
                    refreshPageAfterUnlock();
                    return;
                }

                /* ---- CASI CLASSICI ---- */
                if (searchTerm === 'alicia') {
                    searchResults.innerHTML = `
                        <h2>Risultati della ricerca: "alicia"</h2>
                        
                        <div class="report-section">
                            <h3>REPORT POLIZIA - CASO: Omicidio Alicia Cayada</h3>
                            <p><span class="highlight">Data:</span> 23 maggio 2012</p>
                            <p><span class="highlight">Luogo:</span> Edificio abbandonato di proprietà Herrera, Bosque del Alba, Coruñas</p>
                            <p><span class="highlight">Vittima:</span> Alicia Cayada, 18 anni</p>
                            <p><span class="highlight">Trovato da:</span> Il corpo non è stato rinvenuto</p>
                        </div>
                        
                        <h3>Dettagli dell'Accaduto</h3>
                        <p>Alicia Cayada, scomparsa il 23 maggio 2012, è stata vista l'ultima volta dal suo gruppo di amici tra cui Juan Lopez, Ettore Scala e Manuel Garcìa la sera della scomparsa. I ragazzi negano il loro coinvolgimento. Il corpo di Alicia Cayada non è mai stato ritrovato, ma il gruppo di ricerca numero 3, creato il 24 maggio, ha ritrovato tracce di sangue e oggetti personali della ragazza all'interno della casa abbandonata di proprietà Herrera vicino alla rampa di scale che portava al piano superiore.</p>
                        
                        <h3>Prove Trovate sulla Scena</h3>
                        <ul class="evidence-list">
                            <li><span class="highlight">Gocce di sangue di Alicia:</span> Analizzate in laboratorio dalla polizia scientifica</li>
                            <li><span class="highlight">Accessori:</span> Alcuni oggetti come spille e fermagli identificati dai parenti della ragazza</li>
                            <li><span class="highlight">Assi di legno del corrimano della scala rotte:</span> Numerose scheggie e assi attorno alla scena</li>
                            <li><span class="highlight">Telefono di Alicia:</span> Nessun indizio importante, tranne il video registrato con audio dentro la casa, allegato in fondo al report</li>
                            <li><span class="highlight">Orario dell'omicidio:</span> Stimato nella notte tra il 23 e il 24 maggio</li>
                        </ul>

                        <div class="media-section">
                            <h3>Materiale Multimediale</h3>
                            <div class="media-content">
                                <img src="scenacrimine.jpeg" alt="Foto della scena del crimine" style="width:70%; max-width:400px; display:block; margin:0 auto 15px; border-radius:4px;">
                                <video controls style="width:70%; max-width:400px; display:block; margin:0 auto 15px; border-radius:4px;">
                                    <source src="aliciavideo.mp4" type="video/mp4">
                                    Il tuo browser non supporta la riproduzione video.
                                </video>
                            </div>
                        </div>
  
                        <div class="report-section">
                            <h3>NOTE INVESTIGATIVE</h3>
                            <p>All'interno dell'edificio sono state trovate numerose impronte della ragazza. Il caso è stato chiuso come omicidio senza aver trovato un colpevole</p>
                        </div>

                        <div class="report-section">
                            <h3>NOTA IMPORTANTE</h3>
                            <p>La scomparsa della ragazza è stata classificata all'interno del fascicolo chiamato "secuestrador del bosque". Per ulteriori informazioni cercare il fascicolo nella barra di ricerca. </p>
                        </div>
                        
                        <span class="timestamp">Ultimo aggiornamento: 31 ottobre 2025, ore 20:23</span>
                    `;
                } else if (searchTerm === 'alicia cayada') {
                    searchResults.innerHTML = `
                        <h2>Risultati della ricerca: "alicia cayada"</h2>
                        
                        <div class="report-section">
                            <h3>REPORT POLIZIA - CASO: Omicidio Alicia Cayada</h3>
                            <p><span class="highlight">Data:</span> 23 maggio 2012</p>
                            <p><span class="highlight">Luogo:</span> Edificio abbandonato di proprietà Herrera, Bosque del Alba, Coruñas</p>
                            <p><span class="highlight">Vittima:</span> Alicia Cayada, 18 anni</p>
                            <p><span class="highlight">Trovato da:</span> Il corpo non è stato rinvenuto</p>
                        </div>
                        
                        <h3>Dettagli dell'Accaduto</h3>
                        <p>Alicia Cayada, scomparsa il 23 maggio 2012, è stata vista l'ultima volta dal suo gruppo di amici tra cui Juan Lopez, Ettore Scala e Manuel Garcìa la sera della scomparsa. I ragazzi negano il loro coinvolgimento. Il corpo di Alicia Cayada non è mai stato ritrovato, ma il gruppo di ricerca numero 3, creato il 24 maggio, ha ritrovato tracce di sangue e oggetti personali della ragazza all'interno della casa abbandonata di proprietà Herrera vicino alla rampa di scale che portava al piano superiore.</p>
                        
                        <h3>Prove Trovate sulla Scena</h3>
                        <ul class="evidence-list">
                            <li><span class="highlight">Gocce di sangue di Alicia:</span> Analizzate in laboratorio dalla polizia scientifica</li>
                            <li><span class="highlight">Accessori:</span> Alcuni oggetti come spille e fermagli identificati dai parenti della ragazza</li>
                            <li><span class="highlight">Assi di legno del corrimano della scala rotte:</span> Numerose scheggie e assi attorno alla scena</li>
                            <li><span class="highlight">Telefono di Alicia:</span> Nessun indizio importante, tranne il video registrato con audio dentro la casa, allegato in fondo al report</li>
                            <li><span class="highlight">Orario dell'omicidio:</span> Stimato nella notte tra il 23 e il 24 maggio</li>
                        </ul>

                        <div class="media-section">
                            <h3>Materiale Multimediale</h3>
                            <div class="media-content">
                                <img src="scenacrimine.jpeg" alt="Foto della scena del crimine" style="width:70%; max-width:400px; display:block; margin:0 auto 15px; border-radius:4px;">
                                <video controls style="width:70%; max-width:400px; display:block; margin:0 auto 15px; border-radius:4px;">
                                    <source src="aliciavideo.mp4" type="video/mp4">
                                    Il tuo browser non supporta la riproduzione video.
                                </video>
                            </div>
                        </div>
                        
                        <div class="report-section">
                            <h3>NOTE INVESTIGATIVE</h3>
                            <p>All'interno dell'edificio sono state trovate numerose impronte della ragazza. Il caso è stato chiuso come omicidio senza aver trovato un colpevole</p>
                        </div>

                        <div class="report-section">
                            <h3>NOTA IMPORTANTE</h3>
                            <p>La scomparsa della ragazza è stata classificata all'interno del fascicolo chiamato "secuestrador del bosque". Per ulteriori informazioni cercare il fascicolo nella barra di ricerca. </p>
                        </div>
                        
                        <span class="timestamp">Ultimo aggiornamento: 1 novembre 2025, ore 20:23</span>
                    `;
                } else if (searchTerm === 'isabel') {
                    searchResults.innerHTML = `
                        <h2>Risultati della ricerca: "isabel"</h2>
                        
                        <div class="report-section">
                            <h3>REPORT POLIZIA - CASO: Omicidio Isabel Mata</h3>
                            <p><span class="highlight">Data:</span> 10 agosto 2006</p>
                            <p><span class="highlight">Luogo:</span> Bosque del Alba, Coruñas</p>
                            <p><span class="highlight">Vittima:</span> Isabel Mata, 23 anni</p>
                            <p><span class="highlight">Trovato da:</span> Il corpo non è stato rinvenuto</p>
                        </div>
                        
                        <h3>Dettagli dell'Accaduto</h3>
                        <p>Il corpo di Isabel Mata, scomparsa il 10 agosto 2006 mentre faceva trekking, non è mai stato ritrovato. Il gruppo di ricerca della polizia forestale Alce Rossa, grazie all'aiuto dell'unità cinofila Bravo, ha ritrovato tracce di sangue e oggetti personali della ragazza nel Bosque del Alba.</p>
                        
                        <h3>Prove Trovate sulla Scena</h3>
                        <ul class="evidence-list">
                            <li><span class="highlight">Gocce di sangue di Isabel:</span> Analizzate in laboratorio dalla polizia scientifica</li>
                            <li><span class="highlight">Accessori:</span> Alcuni oggetti personali identificati dai parenti della ragazza</li>
                            <li><span class="highlight">Orario dell'omicidio:</span> Stimato nella sera del 10 agosto 2006</li>
                        </ul>
                        
                        <div class="report-section">
                            <h3>NOTE INVESTIGATIVE</h3>
                            <p>Il caso è stato chiuso come omicidio senza aver trovato un colpevole. </p>
                        </div>

                        <div class="report-section">
                            <h3>NOTA IMPORTANTE</h3>
                            <p>La scomparsa della ragazza è stata classificata all'interno del fascicolo chiamato "secuestrador del bosque". Per ulteriori informazioni cercare il fascicolo nella barra di ricerca. </p>
                        </div>
                        
                        <span class="timestamp">Ultimo aggiornamento: 1 novembre 2012, ore 20:23</span>
                    `;
                } else if (searchTerm === 'isabel mata') {
                    searchResults.innerHTML = `
                        <h2>Risultati della ricerca: "isabel mata"</h2>
                        
                        <div class="report-section">
                            <h3>REPORT POLIZIA - CASO: Omicidio Isabel Mata</h3>
                            <p><span class="highlight">Data:</span> 10 agosto 2006</p>
                            <p><span class="highlight">Luogo:</span> Bosque del Alba, Coruñas</p>
                            <p><span class="highlight">Vittima:</span> Isabel Mata, 23 anni</p>
                            <p><span class="highlight">Trovato da:</span> Il corpo non è stato rinvenuto</p>
                        </div>
                        
                        <h3>Dettagli dell'Accaduto</h3>
                        <p>Il corpo di Isabel Mata, scomparsa il 10 agosto 2006 mentre faceva trekking, non è mai stato ritrovato. Il gruppo di ricerca della polizia forestale Alce Rossa, grazie all'aiuto dell'unità cinofila Bravo, ha ritrovato tracce di sangue e oggetti personali della ragazza nel Bosque del Alba.</p>
                        
                        <h3>Prove Trovate sulla Scena</h3>
                        <ul class="evidence-list">
                            <li><span class="highlight">Gocce di sangue di Isabel:</span> Analizzate in laboratorio dalla polizia scientifica</li>
                            <li><span class="highlight">Accessori:</span> Alcuni oggetti personali identificati dai parenti della ragazza</li>
                            <li><span class="highlight">Orario dell'omicidio:</span> Stimato nella sera del 10 agosto 2006</li>
                        </ul>
                        
                        <div class="report-section">
                            <h3>NOTE INVESTIGATIVE</h3>
                            <p>Il caso è stato chiuso come omicidio senza aver trovato un colpevole. </p>
                        </div>

                        <div class="report-section">
                            <h3>NOTA IMPORTANTE</h3>
                            <p>La scomparsa della ragazza è stata classificata all'interno del fascicolo chiamato "secuestrador del bosque". Per ulteriori informazioni cercare il fascicolo nella barra di ricerca. </p>
                        </div>
                        
                        <span class="timestamp">Ultimo aggiornamento: 1 novembre 2012, ore 20:23</span>
                    `;
                } else if (searchTerm === 'dolores') {
                    searchResults.innerHTML = `
                        <h2>Risultati della ricerca: "dolores"</h2>
                        
                        <div class="report-section">
                            <h3>REPORT POLIZIA - CASO: Omicidio Dolores Perez</h3>
                            <p><span class="highlight">Data:</span> 06 luglio 1999</p>
                            <p><span class="highlight">Luogo:</span> Bosque del Alba, Coruñas</p>
                            <p><span class="highlight">Vittima:</span> Dolores Perez, 20 anni</p>
                            <p><span class="highlight">Trovato da:</span> Il corpo non è stato rinvenuto</p>
                        </div>
                        
                        <h3>Dettagli dell'Accaduto</h3>
                        <p>Dolores Perez, scomparsa il 06 luglio 1999 mentre passeggiava con la famiglia nel Bosque del Alba, si è allontanata dal gruppo per scattare foto alla fauna in tranquillità. Nonostante gli sforzi della polizia e della popolazione locale, il corpo non è mai stato ritrovato. Vicino alla fotocamera rotta, sono state trovate tracce di sangue.</p>
                        
                        <h3>Prove Trovate sulla Scena</h3>
                        <ul class="evidence-list">
                            <li><span class="highlight">Gocce di sangue di Dolores:</span> Analizzate in laboratorio dalla polizia scientifica</li>
                            <li><span class="highlight">Fotocamera:</span> Le condizioni della fotocamera non hanno consentito il recupero di foto</li>
                            <li><span class="highlight">Orario dell'omicidio:</span> Stimato nel pomeriggio del 06 luglio 1999</li>
                        </ul>
                        
                        <div class="report-section">
                            <h3>NOTE INVESTIGATIVE</h3>
                            <p>Il caso è stato chiuso come omicidio senza aver trovato un colpevole. </p>
                        </div>

                        <div class="report-section">
                            <h3>NOTA IMPORTANTE</h3>
                            <p>La scomparsa della ragazza è stata classificata all'interno del fascicolo chiamato "secuestrador del bosque". Per ulteriori informazioni cercare il fascicolo nella barra di ricerca. </p>
                        </div>
                        
                        <span class="timestamp">Ultimo aggiornamento: 1 novembre 2012, ore 20:23</span>
                    `;
                } else if (searchTerm === 'dolores perez') {
                    searchResults.innerHTML = `
                        <h2>Risultati della ricerca: "dolores perez"</h2>
                        
                        <div class="report-section">
                            <h3>REPORT POLIZIA - CASO: Omicidio Dolores Perez</h3>
                            <p><span class="highlight">Data:</span> 06 luglio 1999</p>
                            <p><span class="highlight">Luogo:</span> Bosque del Alba, Coruñas</p>
                            <p><span class="highlight">Vittima:</span> Dolores Perez, 20 anni</p>
                            <p><span class="highlight">Trovato da:</span> Il corpo non è stato rinvenuto</p>
                        </div>
                        
                        <h3>Dettagli dell'Accaduto</h3>
                        <p>Dolores Perez, scomparsa il 06 luglio 1999 mentre passeggiava con la famiglia nel Bosque del Alba, si è allontanata dal gruppo per scattare foto alla fauna in tranquillità. Nonostante gli sforzi della polizia e della popolazione locale, il corpo non è mai stato ritrovato. Vicino alla fotocamera rotta, sono state trovate tracce di sangue.</p>
                        
                        <h3>Prove Trovate sulla Scena</h3>
                        <ul class="evidence-list">
                            <li><span class="highlight">Gocce di sangue di Dolores:</span> Analizzate in laboratorio dalla polizia scientifica</li>
                            <li><span class="highlight">Fotocamera:</span> Le condizioni della fotocamera non hanno consentito il recupero di foto</li>
                            <li><span class="highlight">Orario dell'omicidio:</span> Stimato nel pomeriggio del 06 luglio 1999</li>
                        </ul>
                        
                        <div class="report-section">
                            <h3>NOTE INVESTIGATIVE</h3>
                            <p>Il caso è stato chiuso come omicidio senza aver trovato un colpevole. </p>
                        </div>

                        <div class="report-section">
                            <h3>NOTA IMPORTANTE</h3>
                            <p>La scomparsa della ragazza è stata classificata all'interno del fascicolo chiamato "secuestrador del bosque". Per ulteriori informazioni cercare il fascicolo nella barra di ricerca. </p>
                        </div>
                        
                        <span class="timestamp">Ultimo aggiornamento: 1 novembre 2012, ore 20:23</span>
                    `;
                } else if (searchTerm === 'secuestrador del bosque') { 
                    searchResults.innerHTML = `
                        <h2>Risultati della ricerca: "secuestrador del bosque"</h2>
                        <h3>Dettagli</h3>
                        <p><span class="highlight">Luogo:</span> Bosque del Alba, Coruñas</p>
                        <p>Nel corso degli anni, la figura conosciuta come “il sequestrador del bosque” è stata collegata a una serie di misteriose sparizioni avvenute nella stessa area forestale. Le autorità hanno registrato almeno tre casi dal profilo simile: una ragazza scomparsa nel 1999, una nel 2006 e una nel 2012. Le indagini condotte all’epoca non hanno portato a conclusioni definitive, ma le tracce raccolte sembrano suggerire un pattern ricorrente.</p>

                        <div class="report-section">
                            <h3>NOTA</h3>
                            <p>Nel 1999 è stata registrata la scomparsa di Dolores Perez, nel 2006 è stato aperto un fascicolo per la sparizione di Isabel Mata e nel 2012 è stata denunciata la scomparsa di Alicia Cayada. Per ulteriori dettagli, consultare i dossier individuali delle tre ragazze tramite ricerca nominativa nella barra dedicata </p>
                        </div>

                        <span class="timestamp">Ultimo aggiornamento: 1 novembre 2012, ore 20:23</span>
                   `; 
                } else if (searchTerm === 'rozenheim') {
                    searchResults.innerHTML = `
                        <h2>Risultati della ricerca: "rozenheim"</h2>
                        
                        <div class="report-section">
                            <h3>REPORT POLIZIA - CASO: Omicidio in Villa Rozenheim</h3>
                            <p><span class="highlight">Data:</span> 31 ottobre 2024</p>
                            <p><span class="highlight">Luogo:</span> Studio privato</p>
                            <p><span class="highlight">Vittima:</span> Dottor Viktor Rozenheim, 61 anni</p>
                            <p><span class="highlight">Trovato da:</span> Katarina Viktoria Kinder, alle ore 21:43</p>
                        </div>
                        
                        <h3>Dettagli dell'Accaduto</h3>
                        <p>Il Dott. Viktor Rozenheim è stato trovato senza vita nel suo studio privato, chiuso a chiave dall'interno, steso per terra. La vittima non presentava segni di lotta visibili. L'arma del delitto, un lama affilata, è stata trovata ancora salda al petto del dottore.</p>
                        
                        <h3>Prove Trovate sulla Scena</h3>
                        <ul class="evidence-list">
                            <li><span class="highlight">Impronte digitali:</span> Nessuna</li>
                            <li><span class="highlight">Fibre tessili:</span> Nessuna</li>
                            <li><span class="highlight">Documento per divorzio:</span> Documento con la firma del dottore per il divorzio con Katarina</li>
                            <li><span class="highlight">Orario dell'omicidio:</span> Stimato tra le 21:30 e le 21:40 del 31 ottobre</li>
                        </ul>
                        
                        <h3>Sospetti</h3>
                        <p>5 persone erano assenti al tavolo per la cena al momento della scoperta:</p>
                        <ul class="evidence-list">
                            <li><span class="highlight">Katarina Viktoria Kinder:</span> Moglie del defunto e brillante avvocata</li>
                            <li><span class="highlight">Camille Flumenrush:</span> Ingegnera che lavora al Circolo da un anno, è nel team di sviluppo del Karotienen</li>
                            <li><span class="highlight">Sophie Macarole:</span> Giornalista di grande fama e fan dei progetti del Circolo Rozenheim</li>
                            <li><span class="highlight">Franz Oldenmonten:</span> Giovane apprendista del dottore, neolaureato a pieni voti che aveva ottenuto un tirocinio presso il Circolo</li>
                            <li><span class="highlight">Michael Bittestein:</span> Facoltoso imprenditore tedesco interessato all'acquisto del brevetto del dispositivo</li>
                        </ul>
                        
                        <div class="report-section">
                            <h3>NOTE INVESTIGATIVE</h3>
                            <p>Il dispositivo Karotienen, oggetto principale di discussione della cena, è stato rubato.</p>
                            <p>La porta dello studio era chiusa dall'interno, possibile suicidio o omicidio con utilizzo di veleno.</p>
                        </div>
                        
                        <span class="timestamp">Ultimo aggiornamento: 2 novembre 2024, ore 14:23</span>
                    `;
                } else if (searchTerm === 'viktor') {
                    searchResults.innerHTML = `
                        <h2>Risultati della ricerca: "viktor"</h2>
                        
                        <div class="report-section">
                            <h3>REPORT POLIZIA - CASO: Omicidio in Villa Rozenheim</h3>
                            <p><span class="highlight">Data:</span> 31 ottobre 2024</p>
                            <p><span class="highlight">Luogo:</span> Studio privato</p>
                            <p><span class="highlight">Vittima:</span> Dottor Viktor Rozenheim, 61 anni</p>
                            <p><span class="highlight">Trovato da:</span> Katarina Viktoria Kinder, alle ore 21:43</p>
                        </div>
                        
                        <h3>Dettagli dell'Accaduto</h3>
                        <p>Il Dott. Viktor Rozenheim è stato trovato senza vita nel suo studio privato, chiuso a chiave dall'interno, steso per terra. La vittima non presentava segni di lotta visibili. L'arma del delitto, un lama affilata, è stata trovata ancora salda al petto del dottore.</p>
                        
                        <h3>Prove Trovate sulla Scena</h3>
                        <ul class="evidence-list">
                            <li><span class="highlight">Impronte digitali:</span> Nessuna</li>
                            <li><span class="highlight">Fibre tessili:</span> Nessuna</li>
                            <li><span class="highlight">Documento per divorzio:</span> Documento con la firma del dottore per il divorzio con Katarina</li>
                            <li><span class="highlight">Orario dell'omicidio:</span> Stimato tra le 21:30 e le 21:40 del 31 ottobre</li>
                        </ul>
                        
                        <h3>Sospetti</h3>
                        <p>5 persone erano assenti al tavolo per la cena al momento della scoperta:</p>
                        <ul class="evidence-list">
                            <li><span class="highlight">Katarina Viktoria Kinder:</span> Moglie del defunto e brillante avvocata</li>
                            <li><span class="highlight">Camille Flumenrush:</span> Ingegnera che lavora al Circolo da un anno, è nel team di sviluppo del Karotienen</li>
                            <li><span class="highlight">Sophie Macarole:</span> Giornalista di grande fama e fan dei progetti del Circolo Rozenheim</li>
                            <li><span class="highlight">Franz Oldenmonten:</span> Giovane apprendista del dottore, neolaureato a pieni voti che aveva ottenuto un tirocinio presso il Circolo</li>
                            <li><span class="highlight">Michael Bittestein:</span> Facoltoso imprenditore tedesco interessato all'acquisto del brevetto del dispositivo</li>
                        </ul>
                        
                        <div class="report-section">
                            <h3>NOTE INVESTIGATIVE</h3>
                            <p>Il dispositivo Karotienen, oggetto principale di discussione della cena, è stato rubato.</p>
                            <p>La porta dello studio era chiusa dall'interno, possibile suicidio o omicidio con utilizzo di veleno.</p>
                        </div>
                        
                        <span class="timestamp">Ultimo aggiornamento: 2 novembre 2024, ore 14:23</span>
                    `;
                
                /* =========================================
                   BLOCCO ETTORE – STEP 1 / STEP 2
                ========================================== */
                } else if (searchTerm === 'ettore' || searchTerm === 'ettore scala') {

                    const isFull = isStep2Unlocked();

                    if (!isFull) {
                        // STEP 1 – solo materiale fotografico
                        const label = (searchTerm === 'ettore') ? 'ettore' : 'ettore scala';
                        searchResults.innerHTML = `
                            <h2>Risultati della ricerca: "${label}"</h2>

                            <div class="report-section">
                                <h3>ARCHIVIO - CASO Ettore Scala</h3>
                                <p><span class="highlight">Agente incaricato:</span> Ines Cabral</p>
                                <p><span class="highlight">Data:</span> 1 novembre 2025</p>
                            </div>

                            <div class="media-section">
                                <h3>Materiale Fotografico</h3>
                                <div class="media-content">
                                    <img id="fotoEttore" src="CCTV/sitopolizia.png" alt="Foto stanza" style="width:70%; max-width:400px; display:block; margin:0 auto 15px; border-radius:4px; cursor: zoom-in;">
                                    <p style="text-align:center; color:#ccc;">Scatto all'interno della stanza di Ettore nel Monastero di San Andro Pertiños.</p>
                                </div>
                            </div>
                        `;

                        const fotoEttore = document.getElementById("fotoEttore");
                        if (fotoEttore) {
                            fotoEttore.addEventListener("click", function() {
                                openImageModal("CCTV/sitopolizia.png", "Stanza di Ettore nel monastero");
                            });
                        }

                    } else {
                        // STEP 2 – interrogatori + referto + foto
                        const label = (searchTerm === 'ettore') ? 'ettore' : 'ettore scala';

                        searchResults.innerHTML = `
                            <h2>Risultati della ricerca: "${label}"</h2>

                            <div class="report-section">
                                <h3>ARCHIVIO - CASO Ettore Scala</h3>
                                <p><span class="highlight">Agente incaricato:</span> Ines Cabral</p>
                                <p><span class="highlight">Data:</span> 1 novembre 2025</p>
                            </div>
                            
                            <div class="report-section">
                                <h3>ARCHIVIO INTERROGATORI</h3>
                                <p><span class="highlight">Agente incaricato:</span> Andres Carol</p>
                                <p><span class="highlight">Data:</span> 1 novembre 2025</p>
                                <p>Seleziona un fascicolo per visualizzare la trascrizione dell'interrogatorio.</p>
                            </div>

                            <div class="interrogation-folders">
                                <div class="interrogation-folder" data-person="ezequiel">Ezequiel Torres</div>
                                <div class="interrogation-folder" data-person="luca">Luca Piantagrane</div>
                                <div class="interrogation-folder" data-person="gordon">Gordon Chico Cayada</div>
                                <div class="interrogation-folder" data-person="lucia">Suor Lucia D'Hombres</div>
                                <div class="interrogation-folder" data-person="xamiel">Padre Xamiel</div>
                            </div>

                            <div id="interrogation-content" class="interrogation-content"></div>

                            <div class="media-section">
                                <h3>Materiale Fotografico</h3>
                                <div class="media-content">
                                    <img id="fotoEttore" src="CCTV/sitopolizia.png" alt="Foto stanza" style="width:70%; max-width:400px; display:block; margin:0 auto 15px; border-radius:4px; cursor: zoom-in;">
                                    <p style="text-align:center; color:#ccc;">Scatto all'interno della stanza di Ettore nel Monastero di San Andro Pertiños.</p>
                                    <img id="fotoEttore3" src="biglietto.png" alt="Biglietto" style="width:70%; max-width:400px; display:block; margin:20px auto 15px; border-radius:4px; cursor: zoom-in;">
                                    <p style="text-align:center; color:#ccc;">Bigliettino trovato sul tavolo nella stanza di Ettore.</p>                                                                                                                                                                                                                                                                                                                                                                                  
                                    <img id="fotoEttore2" src="referto.jpeg" alt="Referto" style="width:70%; max-width:400px; display:block; margin:20px auto 15px; border-radius:4px; cursor: zoom-in;">
                                    <p style="text-align:center; color:#ccc;">Referto Ettore Scala.</p>
                                </div>
                            </div>
                        `;

                        const interrogations = {
                            luca: `
                                <h3>Interrogatorio - Luca Piantagrane</h3>
                                <p><span class="highlight">Registrazione 22:44 – Sala colloqui, Monastero di San Andro Pertiños</span></p>
                                <p><strong>Ispettore:</strong> Nome e cognome?</p>
                                <p><strong>Luca:</strong> Luca Piantagrane.</p>
                                <p><strong>Ispettore:</strong> Può dirmi che rapporto aveva con Ettore Scala?</p>
                                <p><strong>Luca:</strong> Lo conoscevo da anni. Eravamo soci, amici… finchè non ha deciso di mollare tutto. Avevamo un progetto grosso assieme. Poi lui se n’è andato, così, da un giorno all’altro, per diventare prete.</p>
                                <p><strong>Ispettore:</strong> Come l’ha presa?</p>
                                <p><strong>Luca:</strong> Come vuole che l’abbia presa? Io ci avevo messo tutto, soldi, tempo, contatti. E lui mi ha rovinato. Ma non ero qui per questo, se è quello che pensa.</p>
                                <p><strong>Ispettore:</strong> Allora perché ha accettato l’invito alla cena?</p>
                                <p><strong>Luca:</strong> Per curiosità, forse per orgoglio. Aveva detto che voleva chiudere i conti con il passato, chiedere perdono. Beh, magari parte di me voleva sentirlo dire di persona.</p>
                                <p><strong>Ispettore:</strong> Si direbbe scosso.</p>
                                <p><strong>Luca:</strong> Sì, lo sono. Non lo odiavo, se è questo che vuole sapere. Era un idiota pieno di rimorsi, non un nemico… Però, glielo dico sinceramente, non piango per lui. Ha sempre pensato di poter scappare dalle sue responsabilità. Adesso… beh, non ci riuscirà più.</p>
                                <p><strong>Ispettore:</strong> Le sue dichiarazioni sono sospette, cosa vuole lasciare intendere?</p>
                                <p><strong>Luca:</strong> Cosa voglio lasciare intendere?! Ma per carità, non scherziamo… Ho studiato farmacia, è chiaro che ha avuto un malore, che cosa c'entro io? Non avete nulla contro di me, lasciatemi andare!</p>
                                <p><strong>Ispettore:</strong> In realtà nella sua stanza abbiamo trovato una scatola piena di Carotiñobur, farmaco che potrebbe essere legato alla morte di Ettore. Una boccetta era mancante. Sa dirci qualcosa a riguardo?</p>
                                <p><strong>Luca:</strong> Si, vorrei denunciare un furto. Quel farmaco è la mia ultima scoperta, l’avevo portato qui, forse ingenuamente, per convincere Ettore a tornare a lavorare assieme. Dovete credermi, è miracoloso, poteva essere l’occasione di tirare su i bilanci. Ma qualcuno è entrato nella mia stanza e l’ha rubato. Non capisco come sia possibile, mi hanno assicurato che sono l’unico ad avere una copia delle chiavi della stanza degli ospiti oltre a Padre Xamiel.</p>
                            `,
                            gordon: `
                                <h3>Interrogatorio - Gordon Chico Cayada</h3>
                                <p><span class="highlight">Registrazione 22:56 – Sala colloqui, Monastero di San Andro Pertiños</span></p>
                                <p><strong>Ispettore:</strong> Nome e cognome?</p>
                                <p><strong>Gordon:</strong> Gordon Cayada.</p>
                                <p><strong>Ispettore:</strong> Da quanto conosceva Ettore Scala?</p>
                                <p><strong>Gordon:</strong> Dal 2012. Allora era uno studente italiano in Erasmus. Eravamo molto amici, al tempo…</p>
                                <p><strong>Ispettore:</strong> Siete rimasti in contatto da allora?</p>
                                <p><strong>Gordon:</strong> Non esattamente. C’è stato un episodio, una notte, quella in cui mia sorella è sparita. Lui è stato uno degli ultimi ad averla vista viva. Ha sempre negato un coinvolgimento, ma sono sicuro che almeno una parte della colpa ce l’avesse. Da allora non abbiamo più la stessa amicizia, la stessa vita di prima.</p>
                                <p><strong>Ispettore:</strong> Quindi lo odiava.</p>
                                <p><strong>Gordon:</strong> Sì. Per anni ammetto di averlo odiato, gli ho anche mandato una lettera in cui gli ho detto tutto ciò che pensavo di lui. Poi però… ho smesso. La rabbia non serve a niente. Quando mi ha invitato a questa cena, pensavo volesse chiedermi scusa, e alla fine ho accettato. Volevo capire se fosse davvero cambiato.</p>
                                <p><strong>Ispettore:</strong> Come si sente adesso?</p>
                                <p><strong>Gordon:</strong> Non lo so. Vuoto. È morto l’unico che poteva dirmi la verità su mia sorella. E la cosa peggiore è che… una parte di me pensava che questa sera fosse l’occasione per chiudere tutto. Per fare pace. Ma sembra che con Ettore le cose finiscano sempre nel modo sbagliato.</p>
                            `,
                            ezequiel: `
                                <h3>Interrogatorio - Ezequiel Torres</h3>
                                <p><span class="highlight">Registrazione 22:34 – Sala colloqui, Monastero di San Andro Pertiños</span></p>
                                <p><strong>Ispettore:</strong> Nome e cognome, per favore.</p>
                                <p><strong>E. Torres:</strong> Ezequiel Torres, signore.</p>
                                <p><strong>Ispettore:</strong> Conosceva la vittima?</p>
                                <p><strong>E. Torres:</strong> Sì, sì, il seminarista… Ettore. Lo conoscevo. Parlava sempre con tutti, ma pure troppo. Io gli dicevo sempre: “Meglio non ficcare il naso dove non serve”. A molte persone qui gli impiccioni non piacciono.</p>
                                <p><strong>Ispettore:</strong> Come mai era presente alla cena?</p>
                                <p><strong>E. Torres:</strong> Ettore era così, aveva un cuore grande. Aveva invitato tutte le persone che passavano dal monastero, per tanto o per poco tempo. Mi aveva chiesto di aiutarlo ad aprire i tavoli, ed è buffo perchè ci siamo conosciuti proprio così, perchè lui mi aveva chiesto aiuto per una qualche questione in giardino che ormai non ricordo neanche più.</p>
                                <p><strong>Ispettore:</strong> Qualcuno è entrato nella stanza di Ettore questa sera. Lei è il custode, aveva accesso a tutte le stanze? Ha notato un mazzo di chiavi sparire di recente?</p>
                                <p><strong>E. Torres:</strong> Ho un mazzo di chiavi, sì, ma non ho accesso alle stanze private, quelle le tengono i padri. Io apro solo dove serve, e richiudo sempre. Non voglio guai.</p>
                                <p><strong>Ispettore:</strong> Secondo lei, chi avrebbe potuto volere la morte di Ettore?</p>
                                <p><strong>E. Torres:</strong> Ma quindi siete sicuri che è stato ammazzato? Pensavo a un infarto, con tutti i pensieri che aveva per la testa quel ragazzo. Non lo so, ma chi è stato sicuro è un uomo che ne capisce di medicina se è riuscito a farlo sembrare così naturale.</p>
                                <p><strong>Ispettore:</strong> Ha qualcosa da aggiungere?</p>
                                <p><strong>E. Torres:</strong> Solo questo: state attenti, voi della polizia. Qui la notte non è come fuori. Ci sono persone che tengono molto ai propri segreti… e certe porte, una volta aperte, non si richiudono più.</p>
                            `,
                            lucia: `
                                <h3>Interrogatorio - Suor Lucia D'Hombres</h3>
                                <p><span class="highlight">Registrazione 23:07 – Sala colloqui, Monastero di San Andro Pertiños</span></p>
                                <p><strong>Ispettore:</strong> Nome e cognome, per favore.</p>
                                <p><strong>Suor Lucia:</strong> Chi io?</p>
                                <p><strong>Ispettore:</strong> Si, nome e cognome.</p>
                                <p><strong>Suor Lucia:</strong> Lucia D’Hombres.</p>
                                <p><strong>Ispettore:</strong> Da quanto tempo vive nel monastero?</p>
                                <p><strong>Suor Lucia:</strong> Tempo? Passa così lento. Isabel era appena andata via. Ninna nanna ninna oh questa bimba a chi la do?</p>
                                <p><strong>Ispettore:</strong> Conosceva bene Ettore Scala?</p>
                                <p><strong>Suor Lucia:</strong> In Biblioteca? (fissa il vuoto) Ha riportato gli ultimi libri?</p>
                                <p><strong>Ispettore:</strong> Dov’era durante la cena?</p>
                                <p><strong>Suor Lucia:</strong> Padre Xamiel non mi ha ancora dato le caramelle gialle. Volete un muffin?</p>
                                <p><strong>Ispettore:</strong> Guardi la questione è seria – Ha visto qualcosa di insolito?</p>
                                <p><strong>Suor Lucia:</strong> (fa una pausa lunga) C’era… una ragazza. In fondo al corridoio. Con i piedi scalzi. Nessuno la guardava, ma lei mi ha sorriso. Mi ha detto: “Non dire nulla, mamma, non ancora.”</p>
                                <p><strong>Ispettore:</strong> Signora, le telecamere non hanno registrato nessun movimento insolito, non c’era nessuno nel monastero.</p>
                                <p><strong>Suor Lucia:</strong> Il Signore perdona anche i silenzi?</p>
                            `,
                            xamiel: `
                                <h3>Interrogatorio - Padre Xamiel</h3>
                                <p><span class="highlight">Registrazione 23:22 – Sala colloqui, Monastero di San Andro Pertiños</span></p>
                                <p><strong>Ispettore:</strong> Nome e cognome?</p>
                                <p><strong>Padre Xamiel:</strong> Padre Xamiel Ortega. Rettore del Monastero di San Andro Pertiños.</p>
                                <p><strong>Ispettore:</strong> Lei era il superiore di Ettore Scala?</p>
                                <p><strong>Padre Xamiel:</strong> Sì. Era sotto la mia guida spirituale. Un giovane brillante, promettente. La sua prematura scomparsa è davvero una tragedia.</p>
                                <p><strong>Ispettore:</strong> Lei dov’era al momento della morte?</p>
                                <p><strong>Padre Xamiel:</strong> A capotavola, naturalmente. Ero ospite e padrone di casa. Ho visto Ettore alzarsi per fare una chiamata. Poi è caduto. È stato un tragico malore, nient’altro.</p>
                                <p><strong>Ispettore:</strong> Non ritiene che ci siano elementi sospetti?</p>
                                <p><strong>Padre Xamiel:</strong> Ritengo che ci sia già abbastanza scandalo senza bisogno di aggiungerne altro. Il monastero è un luogo sacro, non un circo mediatico. Vi invito a trattare l’accaduto con la dovuta discrezione.</p>
                                <p><strong>Ispettore:</strong> Quindi ci chiede di non indagare?</p>
                                <p><strong>Padre Xamiel:</strong> Non rigirate le mie parole. Vi chiedo di rispettare i confini. In passato siete stati abbastanza bravi ad abbandonare le indagini, non credo sarà difficile farlo anche stavolta. Non c’è nulla da scoprire. Le vostre domande rischiano di macchiare irreversibilmente l'immagine di questo monastero.</p>
                                <p><strong>Ispettore:</strong> Ha qualcosa da aggiungere?</p>
                                <p><strong>Padre Xamiel:</strong> Sì. Vi consiglio di concludere presto le vostre indagini. La nostra istituzione è già abbastanza detestata. Alcune verità non servono a nessuno, soprattutto se a pagarne il prezzo è la fede del popolo.</p>
                            `
                        };

                        const folders = document.querySelectorAll('.interrogation-folder');
                        const contentDiv = document.getElementById('interrogation-content');

                        folders.forEach(folder => {
                            folder.addEventListener('click', function() {
                                const person = this.dataset.person;
                                contentDiv.innerHTML = interrogations[person] || "<p>Nessuna trascrizione disponibile.</p>";
                            });
                        });

                        const fotoEttore = document.getElementById("fotoEttore");
                        if (fotoEttore) {
                            fotoEttore.addEventListener("click", function() {
                                openImageModal("CCTV/sitopolizia.png", "Stanza di Ettore nel monastero");
                            });
                        }
                        const fotoEttore2 = document.getElementById("fotoEttore2");
                        if (fotoEttore2) {
                            fotoEttore2.addEventListener("click", function() {
                                openImageModal("referto.jpeg", "Referto Ettore Scala");
                            });
                        }
                        const fotoEttore3 = document.getElementById("fotoEttore3");
                        if (fotoEttore3) {
                            fotoEttore3.addEventListener("click", function() {
                                openImageModal("biglietto.png", "Bigliettino trovato sul tavolo nella stanza di Ettore");
                            });
                        }
                    }

                } else if (searchTerm !== '') {
                    searchResults.innerHTML = `
                        <h2>Risultati della ricerca: "${searchTerm}"</h2>
                        <p>Nessun risultato trovato per il termine specificato.</p>
                        <p>Si prega di verificare il termine di ricerca o contattare la centrale per maggiori informazioni.</p>
                    `;
                } else {
                    searchResults.innerHTML = `<p>Inserire un termine di ricerca per investigare sul caso.</p>`;
                }
            });

            /* =========================================
               TELECAMERE
            ========================================== */
            function generateYearFolders() {
                yearFolders.innerHTML = '';
                const availableYears = [2009, 2012, 2015, 2018, 2021, 2024];
                
                availableYears.forEach(year => {
                    const folder = document.createElement('div');
                    folder.className = 'year-folder';
                    folder.dataset.year = year;
                    
                    folder.innerHTML = `<h4>${year}</h4>`;
                    
                    folder.addEventListener('click', function() {
                        showMonthFolders(year);
                    });
                    
                    yearFolders.appendChild(folder);
                });
            }
            
            function showMonthFolders(year) {
                yearFolders.style.display = 'none';
                monthFolders.style.display = 'grid';
                monthFolders.innerHTML = '';

                const backButton = document.createElement('button');
                backButton.className = 'back-button';
                backButton.textContent = '← Torna agli anni';
                backButton.addEventListener('click', goBackToYears);
                monthFolders.appendChild(backButton);
                
                const title = document.createElement('h3');
                title.textContent = `Seleziona un mese - Anno ${year}`;
                monthFolders.appendChild(title);
                
                const months = [
                    'Febbraio', 'Marzo', 'Maggio', 'Luglio',
                     'Agosto', 'Ottobre', 'Novembre'
                ];
                
                months.forEach((month, index) => {
                    const monthFolder = document.createElement('div');
                    monthFolder.className = 'month-folder';
                    monthFolder.dataset.month = index + 1;
                    
                    monthFolder.innerHTML = `
                        <h5>${month}</h5>
                        <p>Foto telecamere</p>
                    `;
                    
                    monthFolder.addEventListener('click', function() {
                        showCameraImages(year, month, index + 1);
                    });
                    
                    monthFolders.appendChild(monthFolder);
                });
            }
            
            function showCameraImages(year, month, monthNumber) {
                monthFolders.style.display = 'none';
                cameraImages.style.display = 'block';

                cameraImages.innerHTML = `
                    <button class="back-button" onclick="goBackToMonths()">← Torna ai mesi</button>
                    <h3>Immagini Telecamere - ${month} ${year}</h3>
                    <div class="images-grid" id="imagesGrid"></div>
                    <p class="timestamp">Archivio telecamere ${month} ${year} - Ultimo aggiornamento: ${new Date().toLocaleDateString('it-IT')}</p>
                `;

                const imagesGrid = document.getElementById('imagesGrid');
                const yearData = cameraDescriptions[year] || {};
                const descriptions = yearData[month] || [];

                if (descriptions.length === 0) {
                    imagesGrid.innerHTML = `<p>Nessuna immagine disponibile per questo periodo.</p>`;
                    return;
                }

                descriptions.forEach((item, index) => {
                    const camDiv = document.createElement('div');
                    camDiv.className = 'camera-image';
                    camDiv.innerHTML = `
                        <img src="${item.image}" alt="Telecamera ${index + 1}" style="cursor: zoom-in;">
                        <p>${item.text}</p>
                    `;
                    imagesGrid.appendChild(camDiv);

                    const imgElement = camDiv.querySelector('img');
                    imgElement.addEventListener('click', function() {
                        openImageModal(item.image, item.text);
                    });
                });
            }

            /* =========================================
               MODALE IMMAGINI
            ========================================== */
            function openImageModal(src, caption) {
                const modal = document.getElementById("imageModal");
                const modalImg = document.getElementById("modalImg");
                const captionText = document.getElementById("caption");

                modal.style.display = "flex"; // Usa flex per centrare l'immagine
                modal.style.flexDirection = "column";
                modal.style.justifyContent = "center";
                modal.style.alignItems = "center";
    
                modalImg.src = src;
                captionText.textContent = caption;
            }

            // Chiudi la modale cliccando ovunque sullo sfondo nero
            document.getElementById("imageModal").addEventListener("click", function() {
                this.style.display = "none";
            });

            window.addEventListener("click", function(e) {
                const modal = document.getElementById("imageModal");
                if (e.target === modal) {
                    modal.style.display = "none";
                }
            });

            function goBackToYears() {
                monthFolders.style.display = 'none';
                cameraImages.style.display = 'none';
                yearFolders.style.display = 'grid';
            }
            
            window.goBackToMonths = function() {
                cameraImages.style.display = 'none';
                monthFolders.style.display = 'grid';
            };
            
            /* =========================================
               ANIMAZIONE SHAKE LOGIN
            ========================================== */
            const style = document.createElement('style');
            style.textContent = `
                @keyframes shake {
                    0% { transform: translateX(0); }
                    20% { transform: translateX(-10px); }
                    40% { transform: translateX(10px); }
                    60% { transform: translateX(-10px); }
                    80% { transform: translateX(10px); }
                    100% { transform: translateX(0); }
                }
            `;
            document.head.appendChild(style);

        });
    </script>
</body>
</html>
